<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>EmojiLang Visualizer - Compilador Completo</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      margin: 0;
      padding: 20px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
    }
    
    .container {
      max-width: 1400px;
      margin: 0 auto;
      background: white;
      border-radius: 15px;
      box-shadow: 0 20px 40px rgba(0,0,0,0.1);
      overflow: hidden;
    }
    
    .header {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 30px;
      text-align: center;
    }
    
    .header h1 {
      margin: 0;
      font-size: 2.5em;
      font-weight: 300;
    }
    
    .header p {
      margin: 10px 0 0 0;
      opacity: 0.9;
      font-size: 1.1em;
    }
    
    .main-content {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 0;
      min-height: 600px;
    }
    
    .editor-section {
      padding: 30px;
      background: #f8f9fa;
      border-right: 1px solid #e9ecef;
    }
    
    .output-section {
      padding: 30px;
      background: white;
    }
    
    .section-title {
      font-size: 1.5em;
      margin-bottom: 20px;
      color: #333;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .keyboard {
      margin-bottom: 20px;
      padding: 15px;
      background: white;
      border-radius: 10px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    
    .keyboard button {
      font-size: 24px;
      margin: 5px;
      padding: 10px 15px;
      border: none;
      background: #667eea;
      color: white;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    
    .keyboard button:hover {
      background: #5a6fd8;
      transform: translateY(-2px);
    }
    
    textarea {
      width: 100%;
      height: 200px;
      font-size: 16px;
      padding: 15px;
      border: 2px solid #e9ecef;
      border-radius: 10px;
      font-family: 'Courier New', monospace;
      resize: vertical;
      transition: border-color 0.3s ease;
    }
    
    textarea:focus {
      outline: none;
      border-color: #667eea;
    }
    
    .compile-btn {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      padding: 15px 30px;
      font-size: 16px;
      border-radius: 10px;
      cursor: pointer;
      margin-top: 15px;
      transition: all 0.3s ease;
    }
    
    .compile-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
    }
    
    .phases-container {
      display: flex;
      flex-direction: column;
      gap: 20px;
    }
    
    .phase {
      background: #f8f9fa;
      border-radius: 10px;
      padding: 20px;
      border-left: 4px solid #667eea;
    }
    
    .phase h3 {
      margin: 0 0 15px 0;
      color: #333;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .phase-description {
      background: #e3f2fd;
      border-radius: 8px;
      padding: 15px;
      margin-bottom: 15px;
      border-left: 4px solid #2196f3;
    }
    
    .phase-description h4 {
      margin: 0 0 10px 0;
      color: #1976d2;
      font-size: 1.1em;
    }
    
    .phase-description p {
      margin: 0;
      color: #424242;
      line-height: 1.5;
    }
    
    .phase pre {
      background: white;
      padding: 15px;
      border-radius: 8px;
      border: 1px solid #e9ecef;
      overflow-x: auto;
      font-size: 12px;
      line-height: 1.4;
      max-height: 200px;
      overflow-y: auto;
    }
    
    .ast-container {
      background: white;
      border-radius: 8px;
      border: 1px solid #e9ecef;
      padding: 20px;
      margin-top: 15px;
      overflow: auto;
      max-height: 400px;
    }
    
    .stats {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 15px;
      margin-top: 20px;
    }
    
    .stat-card {
      background: white;
      padding: 15px;
      border-radius: 8px;
      text-align: center;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    
    .stat-number {
      font-size: 2em;
      font-weight: bold;
      color: #667eea;
    }
    
    .stat-label {
      color: #666;
      font-size: 0.9em;
      margin-top: 5px;
    }
    
    .errors {
      background: #fee;
      border: 1px solid #fcc;
      border-radius: 8px;
      padding: 15px;
      margin-top: 15px;
    }
    
    .warnings {
      background: #fff3cd;
      border: 1px solid #ffeaa7;
      border-radius: 8px;
      padding: 15px;
      margin-top: 15px;
    }
    
    .examples {
      margin-top: 20px;
    }
    
    .example-btn {
      background: #28a745;
      color: white;
      border: none;
      padding: 8px 15px;
      border-radius: 5px;
      cursor: pointer;
      margin: 5px;
      font-size: 12px;
    }
    
    .example-btn:hover {
      background: #218838;
    }
    
    .loading {
      text-align: center;
      padding: 20px;
      color: #666;
    }
    
    .success {
      color: #28a745;
    }
    
    .error {
      color: #dc3545;
    }
    
    @media (max-width: 768px) {
      .main-content {
        grid-template-columns: 1fr;
      }
      
      .editor-section {
        border-right: none;
        border-bottom: 1px solid #e9ecef;
      }
    }
  </style>
</head>
<body>

  <div class="container">
    <div class="header">
      <h1>üßë‚Äçüíª EmojiLang Visualizer</h1>
      <p>Compilador educativo con todas las fases de compilaci√≥n</p>
    </div>

    <div class="main-content">
      <div class="editor-section">
        <div class="section-title">
          üìù Editor de C√≥digo
        </div>
        
        <div class="keyboard">
          <div>Emojis disponibles:</div>
          <button onclick="insert('üîß')" title="Funci√≥n - Define una funci√≥n">üîß</button>
          <button onclick="insert('üîô')" title="Retorno - Retorna un valor de una funci√≥n">üîô</button>
          <button onclick="insert('‚ùì')" title="Condicional - Inicia una condici√≥n if">‚ùì</button>
          <button onclick="insert('üîÑ')" title="Bucle - Inicia un bucle while">üîÑ</button>
          <button onclick="insert('üß±')" title="Variable - Declara una variable">üß±</button>
          <button onclick="insert('‚ûï')" title="Suma - Operador de suma">‚ûï</button>
          <button onclick="insert('‚ûñ')" title="Resta - Operador de resta">‚ûñ</button>
          <button onclick="insert('üü¢')" title="Multiplicaci√≥n - Operador de multiplicaci√≥n">üü¢</button>
          <button onclick="insert('‚ûó')" title="Divisi√≥n - Operador de divisi√≥n">‚ûó</button>
          <button onclick="insert('üñ®Ô∏è')" title="Imprimir - Funci√≥n para mostrar texto">üñ®Ô∏è</button>
          <button onclick="insert('üé§')" title="Entrada - Funci√≥n para leer entrada del usuario">üé§</button>
          <button onclick="insert('‚úÖ')" title="Verdadero - Valor booleano true">‚úÖ</button>
          <button onclick="insert('‚ùå')" title="Falso - Valor booleano false">‚ùå</button>
        </div>
        
        <textarea id="code" placeholder="Escrib√≠ tu c√≥digo EmojiLang aqu√≠...

Ejemplos:
üñ®Ô∏è('¬°Hola Mundo!')
üß± x = 10
üß± resultado = 5 ‚ûï 3
üñ®Ô∏è(resultado)"></textarea>
        
        <div class="examples">
          <div style="margin-bottom: 10px; font-weight: bold;">Ejemplos r√°pidos:</div>
          <button class="example-btn" onclick="loadExample('hello')">Hola Mundo</button>
          <button class="example-btn" onclick="loadExample('variables')">Variables</button>
          <button class="example-btn" onclick="loadExample('function')">Funci√≥n</button>
          <button class="example-btn" onclick="loadExample('conditional')">Condicional</button>
          <button class="example-btn" onclick="loadExample('loop')">Bucle</button>
        </div>
        
        <button class="compile-btn" onclick="compile()">
          ‚ñ∂Ô∏è Compilar y Visualizar
        </button>
      </div>

      <div class="output-section">
        <div class="section-title">
          üìä Fases del Compilador
        </div>
        
        <div id="loading" class="loading" style="display: none;">
          ‚è≥ Compilando...
        </div>
        
        <div id="phases" class="phases-container">
          <div class="phase">
            <h3>üî§ 1. An√°lisis L√©xico (Tokens)</h3>
            <div class="phase-description">
              <h4>¬øQu√© hace esta fase?</h4>
              <p>El analizador l√©xico convierte el c√≥digo fuente en una secuencia de tokens (unidades l√©xicas). Cada token representa un elemento b√°sico del lenguaje como palabras clave, identificadores, operadores, literales, etc. Esta fase es la primera en el proceso de compilaci√≥n y prepara los datos para el an√°lisis sint√°ctico.</p>
            </div>
            <pre id="tokens">Ingresa c√≥digo y presiona "Compilar" para ver los tokens...</pre>
          </div>

          <div class="phase">
            <h3>üå≥ 2. An√°lisis Sint√°ctico (AST)</h3>
            <div class="phase-description">
              <h4>¬øQu√© hace esta fase?</h4>
              <p>El analizador sint√°ctico toma los tokens y construye un √Årbol de Sintaxis Abstracta (AST). Este √°rbol representa la estructura jer√°rquica del programa, mostrando c√≥mo se relacionan las diferentes partes del c√≥digo. Cada nodo del √°rbol representa una construcci√≥n del lenguaje (expresiones, declaraciones, etc.).</p>
            </div>
            <div id="ast-container" class="ast-container">
              <p>El gr√°fico del √°rbol AST aparecer√° aqu√≠...</p>
            </div>
            <pre id="ast-text">Representaci√≥n textual del AST...</pre>
          </div>

          <div class="phase">
            <h3>üîç 3. An√°lisis Sem√°ntico</h3>
            <div class="phase-description">
              <h4>¬øQu√© hace esta fase?</h4>
              <p>El analizador sem√°ntico verifica que el programa tenga sentido l√≥gico. Valida tipos de datos, verifica que las variables est√©n declaradas antes de usarse, construye la tabla de s√≠mbolos, y detecta errores como variables no declaradas, tipos incompatibles, o funciones llamadas con argumentos incorrectos.</p>
            </div>
            <pre id="semantic">Tabla de s√≠mbolos y validaciones sem√°nticas...</pre>
          </div>

          <div class="phase">
            <h3>‚öôÔ∏è 4. C√≥digo Intermedio</h3>
            <div class="phase-description">
              <h4>¬øQu√© hace esta fase?</h4>
              <p>El generador de c√≥digo intermedio convierte el AST en una representaci√≥n intermedia m√°s simple y uniforme. Esta representaci√≥n es independiente de la m√°quina y facilita las optimizaciones posteriores. Cada instrucci√≥n intermedia es una operaci√≥n b√°sica que puede ser f√°cilmente traducida al c√≥digo final.</p>
            </div>
            <pre id="intermediate">Pseudoc√≥digo intermedio...</pre>
          </div>

          <div class="phase">
            <h3>üöÄ 5. Optimizaci√≥n</h3>
            <div class="phase-description">
              <h4>¬øQu√© hace esta fase?</h4>
              <p>El optimizador mejora el c√≥digo intermedio para hacerlo m√°s eficiente. Aplica t√©cnicas como eliminaci√≥n de c√≥digo muerto, propagaci√≥n de constantes, simplificaci√≥n de expresiones, y otras optimizaciones que mejoran el rendimiento sin cambiar la funcionalidad del programa.</p>
            </div>
            <pre id="optimized">C√≥digo optimizado...</pre>
          </div>

          <div class="phase">
            <h3>üêç 6. C√≥digo Python Final</h3>
            <div class="phase-description">
              <h4>¬øQu√© hace esta fase?</h4>
              <p>El generador de c√≥digo final traduce el c√≥digo intermedio optimizado al lenguaje objetivo (Python en este caso). Esta es la √∫ltima fase del compilador y produce c√≥digo ejecutable que puede ser interpretado por Python. El c√≥digo generado mantiene la funcionalidad del programa original pero en la sintaxis del lenguaje objetivo.</p>
            </div>
            <pre id="python">C√≥digo Python ejecutable...</pre>
          </div>
        </div>
        
        <div id="stats" class="stats" style="display: none;">
          <!-- Estad√≠sticas se agregar√°n din√°micamente -->
        </div>
        
        <div id="errors" class="errors" style="display: none;">
          <!-- Errores se mostrar√°n aqu√≠ -->
        </div>
        
        <div id="warnings" class="warnings" style="display: none;">
          <!-- Advertencias se mostrar√°n aqu√≠ -->
        </div>
      </div>
    </div>
  </div>

  <!-- Cargar D3.js -->
  <script src="node_modules/d3/dist/d3.min.js"></script>
  
  <!-- Scripts del compilador -->
  <script src="src/analysis/lexer.js"></script>
  <script src="src/analysis/parser.js"></script>
  <script src="src/analysis/semantic.js"></script>
  <script src="src/generation/intermediate.js"></script>
  <script src="src/optimization/optimizer.js"></script>
  <script src="src/generation/generator.js"></script>
  <script src="src/generation/simple_generator.js"></script>
  <script src="src/core/compiler.js"></script>
  <script src="src/ui/ast_visualizer.js"></script>

  <script>
    let compiler = null;
    let astVisualizer = null;
    let examples = {
      'hello': 'üñ®Ô∏è("¬°Hola Mundo desde EmojiLang!")',
      'variables': 'üß± nombre = "Juan"\nüß± edad = 25\nüñ®Ô∏è("Hola " ‚ûï nombre)\nüñ®Ô∏è("Tienes " ‚ûï edad ‚ûï " a√±os")',
      'function': 'üîß suma(a, b) {\n  üîô a ‚ûï b\n}\nüß± resultado = suma(10, 20)\nüñ®Ô∏è("La suma es: " ‚ûï resultado)',
      'conditional': 'üß± numero = 15\n‚ùì (numero > 10) {\n  üñ®Ô∏è("El n√∫mero es mayor que 10")\n}',
      'loop': 'üß± contador = 1\nüîÑ (contador <= 5) {\n  üñ®Ô∏è("Contador: " ‚ûï contador)\n  contador = contador ‚ûï 1\n}'
    };

    // Inicializar compilador y visualizador cuando se carga la p√°gina
    window.addEventListener('load', function() {
      compiler = new EmojiLangCompiler();
      astVisualizer = new ASTVisualizer();
      console.log('‚úÖ Compilador EmojiLang inicializado');
      console.log('‚úÖ Visualizador AST inicializado');
    });

    function insert(symbol) {
      const textarea = document.getElementById("code");
      textarea.value += symbol;
      textarea.focus();
    }

    function loadExample(type) {
      const textarea = document.getElementById("code");
      textarea.value = examples[type] || '';
      textarea.focus();
    }

    function compile() {
      const code = document.getElementById("code").value;
      
      if (!code.trim()) {
        alert('Por favor, ingresa alg√∫n c√≥digo para compilar.');
        return;
      }

      if (!compiler) {
        alert('El compilador no est√° inicializado. Recarga la p√°gina.');
        return;
      }

      // Mostrar loading
      document.getElementById('loading').style.display = 'block';
      document.getElementById('phases').style.display = 'none';
      document.getElementById('stats').style.display = 'none';
      document.getElementById('errors').style.display = 'none';
      document.getElementById('warnings').style.display = 'none';

      // Compilar en un setTimeout para permitir que se muestre el loading
      setTimeout(() => {
        try {
          const result = compiler.compile(code);
          
          // Ocultar loading
          document.getElementById('loading').style.display = 'none';
          document.getElementById('phases').style.display = 'flex';
          
          // Mostrar resultados
          if (result.success) {
            displayResults(result);
          } else {
            displayErrors(result.errors);
          }
          
        } catch (error) {
          document.getElementById('loading').style.display = 'none';
          alert('Error durante la compilaci√≥n: ' + error.message);
        }
      }, 100);
    }

    function displayResults(result) {
      // Mostrar cada fase
      for (let i = 0; i < result.steps.length; i++) {
        const step = result.steps[i];
        const details = compiler.getStepDetails(i);
        
        switch (step.name) {
          case 'Tokens':
            document.getElementById('tokens').textContent = details;
            break;
          case 'AST':
            // Mostrar representaci√≥n textual
            document.getElementById('ast-text').textContent = details;
            // Crear visualizaci√≥n gr√°fica del AST
            if (astVisualizer && step.data) {
              astVisualizer.createVisualization('ast-container', step.data);
            }
            break;
          case 'Semantic':
            document.getElementById('semantic').textContent = details;
            break;
          case 'Intermediate':
            document.getElementById('intermediate').textContent = details;
            break;
          case 'Optimized':
            document.getElementById('optimized').textContent = details;
            break;
          case 'Python':
            document.getElementById('python').textContent = details;
            break;
        }
      }

      // Mostrar estad√≠sticas
      displayStats(result.statistics);

      // Mostrar errores y advertencias
      if (result.errors.length > 0) {
        displayErrors(result.errors);
      }

      if (result.warnings.length > 0) {
        displayWarnings(result.warnings);
      }
    }

    function displayStats(stats) {
      const statsContainer = document.getElementById('stats');
      statsContainer.innerHTML = `
        <div class="stat-card">
          <div class="stat-number">${stats.tokens}</div>
          <div class="stat-label">Tokens</div>
        </div>
        <div class="stat-card">
          <div class="stat-number">${stats.astNodes}</div>
          <div class="stat-label">Nodos AST</div>
        </div>
        <div class="stat-card">
          <div class="stat-number">${stats.intermediateInstructions}</div>
          <div class="stat-label">Instrucciones</div>
        </div>
        <div class="stat-card">
          <div class="stat-number">${stats.optimizations}</div>
          <div class="stat-label">Optimizaciones</div>
        </div>
        <div class="stat-card">
          <div class="stat-number">${stats.pythonLines}</div>
          <div class="stat-label">L√≠neas Python</div>
        </div>
      `;
      statsContainer.style.display = 'grid';
    }

    function displayErrors(errors) {
      const errorsContainer = document.getElementById('errors');
      let errorsHtml = '<h4>‚ùå Errores de Compilaci√≥n:</h4>';
      
      for (const error of errors) {
        errorsHtml += `<div>‚Ä¢ ${error.message}</div>`;
      }
      
      errorsContainer.innerHTML = errorsHtml;
      errorsContainer.style.display = 'block';
    }

    function displayWarnings(warnings) {
      const warningsContainer = document.getElementById('warnings');
      let warningsHtml = '<h4>‚ö†Ô∏è Advertencias:</h4>';
      
      for (const warning of warnings) {
        warningsHtml += `<div>‚Ä¢ ${warning.message}</div>`;
      }
      
      warningsContainer.innerHTML = warningsHtml;
      warningsContainer.style.display = 'block';
    }

    // Permitir compilar con Enter
    document.getElementById('code').addEventListener('keydown', function(e) {
      if (e.ctrlKey && e.key === 'Enter') {
        compile();
      }
    });
  </script>

</body>
</html>
